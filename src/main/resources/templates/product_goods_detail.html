<!DOCTYPE html>
<!--[if IE 7]><html class="ie ie7 no-js" lang="en-US"><![endif]--><!--[if IE 8]><html class="ie ie8 no-js" lang="en-US"><![endif]--><!--[if !(IE 7) | !(IE 8)  ]><!-->
<html lang="en" class="no-js">

<head><!-- Basic need -->
	<title>Mango>망고굿즈>detail</title>
	<meta charset="UTF-8">
	<meta name="description" content="">
	<meta name="keywords" content="">
	<meta name="author" content="">
	<link rel="profile" href="#"><!--Google Font-->
	<link rel="stylesheet" href='http://fonts.googleapis.com/css?family=Dosis:400,700,500|Nunito:300,400,600' />
	<!-- Mobile specific meta -->
	<meta name=viewport content="width=device-width, initial-scale=1">
	<meta name="format-detection" content="telephone-no"><!-- CSS files -->
	<link rel="stylesheet" href="css/plugins.css">
	<link rel="stylesheet" href="css/style.css">
	<link rel="stylesheet" href="css/productTest.css">

</head>

<body><!--preloading-->
	<div th:insert="~{common_header::headerFragment}"></div>
	<!-- END | Header -->

	<div class="ticketBackground" style="margin-top: 100px;">
		<div class="container">
			<div class="row">
				<div class="col-md-12">
					<!-- <h1>movie listing - list</h1><ul class="breadcumb"><li class="active"><a href="#">Home</a></li><li><span class="ion-ios-arrow-right"></span>movie listing</li></ul>-->
				</div>
			</div>
		</div>
	</div>

	<!--굿즈 정보시작-->
	<div class="page-single movie-single movie_single">
		<div class="container">
			<div class="row ipad-width2">
				<div class="col-md-4 col-sm-12 col-xs-12">
					<div class="movie-img sticky-sb"><img th:src="${findGoods.productImage}"
							src="images/uploads/movie-single.jpg" alt="" style="max-width: 100%">
						<!--굿즈 구매하기 버튼-->
						<div class="movie-btn">
							<div class="btn-transform transform-vertical">
								<div><a th:href="@{/cart_main(productNo=${productNo})}" class="item item-1 yellowbtn"><i class="ion-card"></i>굿즈 구매</a>
								</div>
								<div><a th:href="@{/cart_main(productNo=${productNo})}" class="item item-2 yellowbtn"><i class="ion-card"></i>굿즈 구매</a>
								</div>
							</div>
						</div>
					</div>
				</div>

				<!--굿즈 정보표시-->
				<div class="col-md-8 col-sm-12 col-xs-12">
					<div class="movie-single-ct main-content">
						<h1 class="bd-hd" th:text="${findGoods.productName}" style="margin-left: 30%;">Skyfall: Quantum
							of Spectre
						</h1>
						<span>
							<p> <span th:text="${findGoods.productPrice}+'원'"
									style="margin-bottom: 15px; margin-left: 80%; font-size: 30px; color: aqua;"></span>
							</p>
							<!--</div>-->
							<!--굿즈 좋아요-->

							<!--굿즈 상세설명 및 댓글-->
							<div class="movie-tabs">
								<div class="tabs">
									<div class="tab-content">
										<div id="overview" class="tab active">
											<div class="row">
												<div class="col-md-8 col-sm-12 col-xs-12">
													<p><span th:text="${findGoods.productContent}"></span></p>
													<p>
														<img th:src="${findGoods.productImage}"
															alt="Product Artist Image">
													</p>
												</div>

											</div>
										</div>

										<div id="reviews" class="tab review">
											<div class="row">
												<!--관련무비 정보[시작]-->
												<!--<div class="rv-hd">
												<div class="div">
													<h3>Related Movies To</h3>
													<h2>Skyfall: Quantum of Spectre</h2>
												</div><a href="#" class="redbtn">댓글작성버튼/a>
											</div>-->
												<!--관련무비 정보[마지막]-->

												<!--정렬탭[시작]-->
												<!--정렬탭[마지막]-->

												<!--댓글란[시작]-->
												<div class="mv-user-review-item">

													<!--리스트로 나열할 것들[시작]-->
													<div class="user-infor">
														<!--<img src="images/uploads/userava1.jpg" alt="">-->
														<div class="comments"
															style="margin-top: 20px; margin-bottom: 50px;">



															<div th:each="ReplyList : ${ReplyList}">
																<div class="cmt-item flex-it">
																	<img src="images/uploads/author.png" alt="">

																	<!--댓글작성자 정보 및 댓글내용[시작]-->
																	<div class="author-infor">
																		<p>댓글내용</p>
																		<div class="flex-it2">
																			<p th:text="${ReplyList.ProductReplyContent}"
																				style="color: white;"> content </p>
																		</div>
																	</div>
																	<!--댓글작성자 정보 및 댓글내용[마지막]-->
																</div>
															</div>
														</div>

													</div>
													<!--리스트로 나열할 것들 [마지막]-->


													<!--댓글 수정 및 삭제 폼[마지막]-->

												</div>
												<!--댓글란[마지막]-->

											</div>
											<!--댓글보기 내용[마지막]-->

										</div>
										<!--댓글보기 전체[마지막]-->

										<!--아티스트 보기-->
							<div
									style="display: flex; align-items: center; font-size: 15px;">
									<input type="hidden" id="productNo" th:value="${findGoods.productQty}">
									<input type="hidden" class='test'
										th:data-productNo='${findGoods.productQty}'
										th:value='${findGoods.productQty}'>
									<button class="quantity-control"
										onclick="changeQuantity(-1, this)"
										style="width: 35px; height: 35px; background-color: rgb(2, 15, 25); font-size: 20px; line-height: 25px; border: solid 1px white;">-</button>
									<input id="productQty" type="text"
										style="width: 50px; height: 35px; background-color: rgb(2, 15, 25); text-align: center; font-size: 15px; border: solid 1px white; color: white;"
										th:value="${findGoods.productQty}" >
									<button class="quantity-control"
										onclick="changeQuantity(1, this)"
										style="width: 35px; height: 35px; background-color: rgb(2, 15, 25); font-size: 20px; border: solid 1px white; line-height: 25px;">+</button>
								</div> 

										<div id="media" class="tab">
											<div class="row">
												<div class="rv-hd">
													<div>
														<h3>아티스트 : <span th:text="${findGoods.productArtist}"></span>
														</h3>
														<h2>공연제목 : <span th:text="${findGoods.productName}"></span></h2>
													</div>
												</div>
												<div class="title-hd-sm">
													<h4>트레일러<span></span></h4>
												</div>
												<div class="mvsingle-item media-item">
													<div class="vd-item">
														<div class="vd-it"><img class="vd-img"
																src="images/uploads/vd-item1.jpg" alt=""><a
																class="fancybox-media hvr-grow"
																href="https://www.youtube.com/embed/o-0hcF97wy0"><img
																	src="images/uploads/play-vd.png" alt=""></a></div>
														<div class="vd-infor">
															<h6><a href="${findGoods.productMovie}"><span
																		th:text="${findGoods.productName}"></span></a>
															</h6>
															<p class="time">1: 31</p>
														</div>
													</div>
												</div>
											</div>

										</div>
									</div>
								</div>
							</div>
					</div>
				</div>
			</div>
		</div><!-- footer section-->
		<div th:insert="~{common_footer :: footerFragment}"></div>
		<!-- end of footer section-->

</body>
<script>
	function create_reply() {
		const urlParams = new URLSearchParams(window.location.search);
		const productNo = urlParams.get("productNo");

		var commentContent = $("#comment_content").val()
		console.log(commentContent);

		const commentData = {
			"productReplytTitle": "댓글타이틀",
			"productReplyContent": commentContent,
			"productNo": productNo,
			"userId": "myr1109" //세션처리 아이디넣으면 자동으로 이름들어옴
		}
		console.log(commentData);
		fetch(`/2023-05-JAVA-DEVELOPER-final-project-team1-mango/product_reply_create/${productNo}`, {
			method: 'POST',
			headers: {
				'Content-Type': 'application/json'
			},
			body: JSON.stringify(commentData)
		})
			.then(response => {
				if (response.status === 201) {
					alert('댓글 등록되었습니다.');
					//	location.reload(); // 현재 페이지를 새로 고침
					window.location.href = "/2023-05-JAVA-DEVELOPER-final-project-team1-mango/product_goods_detail?productNo=" + productNo;
				} else {
					alert('댓글 등록에 실패했습니다.');
					alert('에러 발생: ' + error);

				}
			})
			.catch(error => {
				alert('에러 발생: ' + error);
			});


	}

	function sendPostRequest() {

		/* 결제하기 버튼을 클릭했을 때 실행되는 결제 함수(현대적인 방법의 ajax = 순수 자바스크립트로만 쓰임, 제이쿼리 X) */
		// userId 가져오기
		var userIdElement = document.getElementById("sUserId");
		var userId = userIdElement.value;
		// AJAX 요청을 보낼 URL 및 데이터 설정
		// 결제 처리를 수행하는 서버 엔드포인트 URL (OrderController의 saveCartOrder 메소드 주소)
		var url = '/2023-05-JAVA-DEVELOPER-final-project-team1-mango/cart/insertCartItem';
		var requestData = {			
			userId: userId
		};
		console.log(requestData);
		// AJAX 요청 보내기
		var xhr = new XMLHttpRequest();
		xhr.open('POST', url, true);
		xhr.setRequestHeader('Content-Type', 'application/json');
		xhr.onreadystatechange = function () {
			if (xhr.readyState === 4) {
				if (xhr.status === 200 || xhr.status === 405) {
					// 결제가 성공적으로 완료될 경우 실행할 코드
					var response = JSON.parse(xhr.responseText);
					alert('성공적으로 카트에 담겼습니다.');
					//주문내역으로 redirect
            		window.location.replace('cart_main');
            		
				} else {
					// 결제가 실패한 경우 실행할 코드
					alert('카트담기 실패하였습니다.');
					
				}
			}
		}
		xhr.send(JSON.stringify(requestData)); // 요청 데이터를 JSON 문자열로 변환하여 보냅니다.
	};

	//product 수량 설정
	function changeQuantity(amount, button) {
	    // 입력 필드에서 현재 수량 가져오기
	    const inputElement = button.parentNode.querySelector('#productQty');
	    let currentQty = parseInt(inputElement.value);

	    // 버튼 클릭에 따라 수량 업데이트
	    currentQty += amount;

	    // 수량 최소 1이상
	    currentQty = Math.max(currentQty, 0);

	    // 새로운 수량으로 입력 필드 업데이트
	    inputElement.value = currentQty;

	    // 숨겨진 입력 필드에서 제품 번호 가져오기
	    const productNo = button.parentNode.querySelector('#productNo').value;

	    // AJAX를 사용하여 서버에 업데이트된 수량 보내기
	    fetch("/product_goods_detail/qty", {
	        method: "POST",
	        headers: {
	            "Content-Type": "application/json",
	        },
	        body: JSON.stringify({
	            productNo: productNo,
	            productQty: currentQty,
	        }),
	    })
	    .then(response => response.json())
	    .then(data => {
	        console.log("업데이트된 수량:", data.productQty);
	    })
	    .catch(error => {
	        console.error("수량 업데이트 중 오류:", error);
	    });
	}
</script>
<script src="js/jquery.js"></script>
<script src="js/plugins.js"></script>
<script src="js/plugins2.js"></script>
<script src="js/custom.js"></script>
<!--<script src="js/product.js"></script>-->

</html>